<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crunchyroll Poster Scraper</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        #result { margin-top: 20px; }
        #result img { max-width: 100%; height: auto; margin: 10px 0; }
        .error { color: red; }
        .info { color: blue; font-style: italic; }
    </style>
</head>
<body>
    <h1>Crunchyroll Poster Scraper</h1>
    <p class="info">Enter a Crunchyroll series URL (e.g., https://www.crunchyroll.com/series/GRVN8MNQY/classroom-of-the-elite). <br>
    Note: This uses a public CORS proxy (cors-anywhere.herokuapp.com). If it fails, visit <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank">this link</a> to request temporary access. <br>
    This is for personal use only; respect Crunchyroll's TOS.</p>
    
    <input type="text" id="urlInput" placeholder="Paste Crunchyroll series URL here..." value="https://www.crunchyroll.com/series/GRVN8MNQY/classroom-of-the-elite">
    <button onclick="getPoster()">Fetch Poster</button>
    
    <div id="result"></div>

    <script>
        async function getPoster() {
            const url = document.getElementById('urlInput').value;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Loading...</p>';

            try {
                // Extract CID from URL
                const cidMatch = url.match(/\/series\/([A-Z0-9]+)/);
                if (!cidMatch) {
                    throw new Error('Invalid URL: No series ID found. Must contain /series/XXXXX');
                }
                const cid = cidMatch[1];

                // Get token using CORS proxy
                const proxy = 'https://cors-anywhere.herokuapp.com/';
                const tokenUrl = proxy + 'https://www.crunchyroll.com/auth/v1/token';
                const tokenResponse = await fetch(tokenUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic Y3Jfd2ViOg==',
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: 'grant_type=client_id'
                });
                if (!tokenResponse.ok) {
                    throw new Error(`Token fetch failed: ${tokenResponse.status}`);
                }
                const tokenData = await tokenResponse.json();
                const bearer = tokenData.access_token;

                // Get series data
                const dataUrl = proxy + `https://www.crunchyroll.com/content/v2/cms/series/${cid}?locale=en-US`;
                const dataResponse = await fetch(dataUrl, {
                    headers: {
                        'Authorization': `Bearer ${bearer}`
                    }
                });
                if (!dataResponse.ok) {
                    throw new Error(`Data fetch failed: ${dataResponse.status}`);
                }
                const jsonData = await dataResponse.json();
                if (!jsonData.data || jsonData.data.length === 0) {
                    throw new Error('No data found for this series.');
                }
                const series = jsonData.data[0];

                // Parse data
                const title = `${series.title || 'Unknown'} - ${series.series_launch_year || 'N/A'}`;
                const images = series.images || {};
                const landscape = images.poster_wide?.[0]?.[images.poster_wide[0].length - 1]?.source || 'N/A';
                const portrait = images.poster_tall?.[0]?.[images.poster_tall[0].length - 1]?.source || 'N/A';

                // Display result
                resultDiv.innerHTML = `
                    <h2>${title}</h2>
                    ${landscape !== 'N/A' ? `<h3>Landscape Poster:</h3><img src="${landscape}" alt="Landscape Poster">` : '<p>No landscape poster found.</p>'}
                    ${portrait !== 'N/A' ? `<h3>Portrait Poster:</h3><img src="${portrait}" alt="Portrait Poster">` : '<p>No portrait poster found.</p>'}
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">Error: ${error.message}</p><p class="info">Try requesting proxy access or check the URL.</p>`;
            }
        }

        // Auto-run on load with default URL
        window.onload = () => getPoster();
    </script>
</body>
</html>
